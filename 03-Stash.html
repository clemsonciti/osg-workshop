<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Data storage and transfer</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <h1 class="title">Data storage and transfer</h1>
          <div class="objectives" markdown="1">
<h4 id="objectives">Objectives</h4>
<ul>
<li>Discover how to transfer input and output data<br />
</li>
<li>Learn the what, why, how, and whens of using Stash</li>
</ul>
</div>
<h2>
Overview
</h2>
<p>In this lesson, we will learn the basics of data storage and transfer on OSG Connect.</p>
<h2>
Stash
</h2>
<p>Stash is a distributed filesystem for temporary storage on OSG Connect. You can put any input or output files here.</p>
<p>First, log in to OSG Connect: <sub>~</sub> ssh username@login.osgconnect.net #Connect to the login node with your username passwd: # your password <sub>~</sub></p>
<p>Once done, you can change to the ‘data’ directory in your home area: <sub>~</sub> $ cd ~/data # This is your <em>stash</em> directory <sub>~</sub> {:class=“in”}</p>
<p>You can also make data on <em>stash</em> publically available on the web. Any data copied or moved to the directory <em>~/data/public</em> can be accessed here:</p>
<pre><code>http://stash.osgconnect.net/+yourusername.</code></pre>
<h2>
File Transfer to Stash
</h2>
<p>We can transfer files from our laptop to <em>stash</em> with scp, sftp, or Globus Connect. For small files (&lt;50MB), it is fine to use scp or sftp utilities. For larger files or when your access may be intermittent, we recommend using Globus.</p>
<p>To transfer a file called “BigData.tar.gz” via scp from your local laptop to <em>stash</em></p>
<pre><code>scp BigData.tar.gz username@login.osgconnect.net:~/data/.  #Transfers the file &quot;BigData.tar.gz&quot; using secured copy.</code></pre>
<p>{:class=“in”}</p>
<h2>
Downloading data from Stash
</h2>
<p>Let us do an example calculation to understand the use of <em>stash</em> and how we download the data from the web. We will peform molecular dynamics simulation of a small protein in implicit water. To get the necessary files, we use the <em>tutorial</em> command on OSG.</p>
<p>Log in OSG</p>
<pre><code>$ ssh username@login.osgconnect.net</code></pre>
<p>type</p>
<pre><code>$ tutorial stash-namd
$ cd ~/osg-stash-namd</code></pre>
<pre><code>namd_stash_run.submit #Condor job submission script file.
namd_stash_run.sh #Job execution script file.
ubq_gbis_eq.conf #Input configuration for NAMD.
ubq.pdb #Input pdb file for NAMD.
ubq.psf #Input file for NAMD.
par_all27_prot_lipid.inp #Parameter file for NAMD.</code></pre>
<p>The file - “par_all27_prot_lipid.inp” is the parameter file and is required for the NAMD simulations. The parameter file is common data file for the NAMD simulations. It is a good practice to keep the common files, like the parameter file in our example, in the <em>stash</em> storage.</p>
<pre><code>mv par_all27_prot_lipid.inp ~/data/public/.  #moving the parameter file from the local directory ~/osg-namd-stash  to ~/data/public </code></pre>
<p>You can view the parameter file appear on WWW</p>
<pre><code>http://stash.osgconnect.net/+yourusername</code></pre>
<p>Now we want the parameter file available on the execution (worker) machine when the simulation starts to run. As mentioned early, the data on the <em>stash</em> is available to the execution machines. This means the execution machine can transfer the data from <em>stash</em> as a part of the job execution. So we have to script this in the job execution script.</p>
<p>You can see that the job execution script “namd_stash_run.sh” has the following lines:</p>
<pre><code>#!/bin/bash  
source /cvmfs/oasis.opensciencegrid.org/osg/modules/lmod/5.6.2/init/bash #sourcing a shell specific file that adds the module command to your environment
module load namd/2.9  #loading the namd module
wget --no-check-certificate http://stash.osgconnect.net/+username/par_all27_prot_lipid.inp # Getting the data from the *stash*. Insert your username. 
namd2 ubq_gbis_eq.conf  #Executing the NAMD simulation</code></pre>
<p>In the above script, you will have to insert your “username” in URL address. The parameter file located on <em>stash</em> is downloaded using the #wget# utility.</p>
<p>Now we submit the NAMD job.</p>
<pre><code>$ condor_submit namd_stash_run.submit </code></pre>
<p>Once the job completes, you will see non-empty “job.out.0” file where the standout output from the programs are written as default.</p>
<pre><code>$ tail job.out.0

WallClock: 6.084453  CPUTime: 6.084453  Memory: 53.500000 MB
Program finished.</code></pre>
<p>The above lines indicate the NAMD simulation was successful.</p>
<div class="keypoints" markdown="1">
<h4 id="key-points">Key Points</h4>
<ul>
<li>Data on <em>stash</em> is quickly accessed by the worker machines.</li>
<li><em>stash</em> is located at ~/data on login.osgconnect.net.</li>
<li><em>scp</em> and <em>rsync</em> are useful tools for data transfer.</li>
</ul>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
